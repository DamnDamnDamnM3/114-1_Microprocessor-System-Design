# Lab 6 - 數字選擇系統與交通號誌控制

## 實驗概述
本實驗使用NUC100系列微控制器，實作兩個不同的應用程式：數字選擇與求和系統，以及交通號誌控制系統。結合LCD顯示、LED控制、蜂鳴器和按鍵輸入，建立完整的嵌入式系統應用。

## 硬體環境
- **微控制器**: NUC100系列
- **按鍵矩陣**: 3x3按鍵矩陣連接至PA0,1,2,3,4,5
- **LCD顯示器**: 16x4字元LCD顯示器
- **LED**: 4個LED連接至PC12,13,14,15
- **蜂鳴器**: 連接至PB11
- **七段顯示器**: 4位七段顯示器
- **交通號誌LED**: 連接至PA12,13,14

## 硬體連接說明

### 按鍵矩陣連接
```
按鍵矩陣    →    GPIO腳位
Row 0      →    PA0
Row 1      →    PA1  
Row 2      →    PA2
Col 0      →    PA3
Col 1      →    PA4
Col 2      →    PA5
```

### LCD顯示器連接
```
LCD功能    →    說明
16x4顯示   →    16字元x4行顯示
字元顯示   →    支援ASCII字元
行控制    →    支援多行顯示
```

### LED連接
```
LED編號    →    GPIO腳位    功能
LED1       →    PC12       選擇指示器1
LED2       →    PC13       選擇指示器2
LED3       →    PC14       選擇指示器3
LED4       →    PC15       選擇指示器4
```

### 蜂鳴器連接
```
蜂鳴器      →    GPIO腳位    功能
控制腳      →    PB11       蜂鳴器控制
```

### 交通號誌LED連接
```
LED顏色    →    GPIO腳位    功能
藍色LED    →    PA12       背景光
綠色LED    →    PA13       綠燈指示
紅色LED    →    PA14       紅燈指示
```

## 程式檔案說明

### Q1.c - 數字選擇與求和系統
**功能**: 從4個隨機數中選擇數字並計算總和，使用LCD顯示和LED指示

**系統特點**:
- 自動產生4個10-99的隨機數
- 使用者可以選擇最多4個數字
- LED指示已選擇的數字數量
- LCD顯示當前總和和可選擇的數字
- 支援重置、清除和返回功能

**按鍵功能表**:
| 按鍵 | 功能 | 說明 |
|------|------|------|
| 4    | 向上移動 | 游標向上移動 |
| 6    | 向下移動 | 游標向下移動 |
| 5    | 選擇數字 | 選擇當前游標位置的數字 |
| 7    | 重置系統 | 產生新的隨機數並重置所有狀態 |
| 8    | 返回 | 取消最後一次選擇 |
| 9    | 清除所有 | 清除所有選擇但保持隨機數 |

**顯示格式**:
```
第0行: SUM = [總和]
第1行: > [數字1]  (游標指示)
第2行:   [數字2]
第3行:   [數字3]
```

**LED指示**:
- LED1: 已選擇1個數字
- LED2: 已選擇2個數字
- LED3: 已選擇3個數字
- LED4: 已選擇4個數字

**隨機數產生**:
- 使用線性同餘生成器(LCG)
- 種子來源：計數器值
- 範圍：10-99

### Q2.c - 交通號誌控制系統
**功能**: 實作交通號誌的狀態控制和倒數計時顯示

**交通號誌狀態**:
| 狀態 | 持續時間 | LED狀態 | 說明 |
|------|----------|---------|------|
| 綠燈 | 8秒 | PA12=1, PA13=0, PA14=1 | 車輛可通行 |
| 黃燈 | 5秒 | PA12=1, PA13=0, PA14=0 | 準備停止 |
| 紅燈 | 13秒 | PA12=1, PA13=1, PA14=0 | 車輛停止 |

**按鍵控制**:
| 按鍵 | 功能 | 說明 |
|------|------|------|
| 1    | 強制綠燈 | 立即切換到綠燈狀態 |
| 2    | 強制黃燈 | 立即切換到黃燈狀態 |
| 3    | 強制紅燈 | 立即切換到紅燈狀態 |
| 9    | 增加時間 | 增加5秒倒數時間 |

**狀態轉換**:
```
綠燈(8秒) → 黃燈(5秒) → 紅燈(13秒) → 綠燈(8秒) → ...
```

**顯示功能**:
- 七段顯示器顯示倒數時間
- LED顯示當前交通號誌狀態
- 支援手動控制和時間調整

## 技術重點

### 數字選擇系統
- **游標控制**: 使用游標位置和視窗偏移實現滾動顯示
- **狀態管理**: 使用陣列管理選擇的數字和狀態
- **LED指示**: 根據選擇數量動態更新LED狀態
- **隨機數產生**: 使用LCG算法產生隨機數

### 交通號誌控制
- **狀態機設計**: 使用列舉和結構體管理狀態
- **時間控制**: 使用計數器實現精確的時間控制
- **LED控制**: 根據狀態控制不同的LED組合
- **手動控制**: 支援按鍵強制切換狀態

### 按鍵處理
- **防彈跳**: 避免按鍵重複觸發
- **狀態檢測**: 檢測按鍵按下和釋放
- **功能映射**: 將按鍵映射到對應功能

### 顯示控制
- **LCD顯示**: 支援多行文字顯示
- **七段顯示器**: 使用多工顯示技術
- **動態更新**: 即時更新顯示內容

## 程式架構

### 初始化階段
```c
SYS_Init();              // 系統初始化
init_LCD();              // LCD初始化
OpenKeyPad();            // 按鍵掃描初始化
init_leds();             // LED初始化
init_buzzer();           // 蜂鳴器初始化
```

### 主迴圈結構
```c
while(1) {
    // 按鍵掃描
    // 事件處理
    // 顯示更新
    // 延遲控制
}
```

### 函數模組
- **硬體控制**: LED、蜂鳴器控制
- **隨機數產生**: 自定義隨機數函數
- **顯示控制**: LCD和七段顯示器控制
- **狀態管理**: 系統狀態和資料管理

## 學習目標
- 掌握複雜嵌入式系統設計
- 理解狀態機和資料結構設計
- 學習隨機數產生和演算法實作
- 熟悉多種顯示器控制技術
- 培養系統整合和除錯能力

## 擴展應用
- 可增加更多數字選擇功能
- 可實作更複雜的交通號誌系統
- 可增加感測器輸入
- 可整合網路通訊功能
- 可實作多路口協調控制

## 注意事項
- 隨機數產生要確保變化性
- 狀態機轉換要確保正確性
- 顯示更新要確保同步性
- 按鍵處理要避免重複觸發
- 硬體連接要確保正確性
