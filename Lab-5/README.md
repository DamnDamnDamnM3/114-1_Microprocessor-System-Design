# Lab 5 - 密碼鎖系統與數位顯示控制

## 實驗概述
本實驗使用NUC100系列微控制器，實作兩個不同的應用程式：密碼鎖系統和數位顯示控制系統。結合LCD顯示、七段顯示器、LED控制、蜂鳴器和按鍵輸入，建立完整的嵌入式系統應用。

## 硬體環境
- **微控制器**: NUC100系列
- **按鍵矩陣**: 3x3按鍵矩陣連接至PA0,1,2,3,4,5
- **LCD顯示器**: 16x4字元LCD顯示器
- **七段顯示器**: 4位七段顯示器連接至PC4,5,6,7(位選)和PE0-7(段選)
- **LED**: RGB LED(PA12,13,14)和右側LED陣列(PB8,9,10,12,13,14,15)
- **蜂鳴器**: 連接至PB11

## 硬體連接說明

### 按鍵矩陣連接
```
按鍵矩陣    →    GPIO腳位
Row 0      →    PA0
Row 1      →    PA1  
Row 2      →    PA2
Col 0      →    PA3
Col 1      →    PA4
Col 2      →    PA5
```

### LCD顯示器連接
```
LCD功能    →    說明
16x4顯示   →    16字元x4行顯示
字元顯示   →    支援ASCII字元
行控制    →    支援多行顯示
```

### 七段顯示器連接
```
七段顯示器  →    GPIO腳位    功能
位選1      →    PC4        第1個顯示器
位選2      →    PC5        第2個顯示器
位選3      →    PC6        第3個顯示器
位選4      →    PC7        第4個顯示器
段A        →    PE3        頂段
段B        →    PE4        右上段
段C        →    PE0        右下段
段D        →    PE5        底段
段E        →    PE6        左下段
段F        →    PE2        左上段
段G        →    PE7        中段
段DOT      →    PE1        小數點
```

### LED連接
```
LED類型    →    GPIO腳位    功能
RGB LED    →    PA12       紅色LED
           →    PA13       綠色LED
           →    PA14       藍色LED
右側LED    →    PB8        右側LED陣列
           →    PB9
           →    PB10
           →    PB12
           →    PB13
           →    PB14
           →    PB15
```

### 蜂鳴器連接
```
蜂鳴器      →    GPIO腳位    功能
控制腳      →    PB11       蜂鳴器控制
```

## 程式檔案說明

### Q1.c - 密碼鎖系統
**功能**: 實作一個4位數密碼鎖，包含LCD顯示、七段顯示器、LED和蜂鳴器

**系統特點**:
- 自動產生4位數隨機密碼(1-6)
- 使用者輸入4位數密碼
- 密碼正確：LED跑馬燈效果 + 成功提示
- 密碼錯誤：蜂鳴器響聲 + 錯誤提示
- 支援重新產生密碼和清除輸入

**按鍵功能表**:
| 按鍵 | 功能 | 說明 |
|------|------|------|
| 1-6  | 輸入數字 | 輸入密碼數字1-6 |
| 7    | 重新產生密碼 | 產生新的隨機密碼 |
| 8    | 清除輸入 | 清除當前輸入 |
| 9    | 確認輸入 | 驗證密碼 |

**密碼產生機制**:
- 使用多個種子來源產生隨機數
- 結合計數器、系統時鐘和GPIO狀態
- 確保每次產生的密碼都不同

**LED效果**:
- 密碼正確：右側LED跑馬燈 + PC LED跑馬燈
- 密碼錯誤：蜂鳴器響120ms

### Q2.c - 數位顯示控制系統
**功能**: 實作數位顯示控制，支援不同進制顯示

**顯示模式**:
- 無符號整數(U): 顯示0-255
- 有符號整數(S): 顯示-128到127
- 十六進制(X): 顯示0x00-0xFF

**按鍵控制**:
| 按鍵 | 功能 | 說明 |
|------|------|------|
| 1    | 右移1位 | 數值右移1位 |
| 3    | 左移1位 | 數值左移1位 |
| 4    | 右移0位 | 數值右移1位(補0) |
| 6    | 左移0位 | 數值左移1位(補0) |
| 5    | 清零 | 數值設為0 |
| 7    | 無符號模式 | 切換到無符號整數顯示 |
| 8    | 有符號模式 | 切換到有符號整數顯示 |
| 9    | 十六進制模式 | 切換到十六進制顯示 |
| 2    | 隨機數 | 產生隨機數值 |

### Sevent_Segment.c - 七段顯示器驅動程式
**功能**: 提供七段顯示器的底層驅動函數

**主要函數**:
- `OpenSevenSegment()`: 初始化七段顯示器
- `ShowSevenSegment()`: 顯示指定位置的數字
- `CloseSevenSegment()`: 關閉所有顯示器

**數字符號定義**:
```c
#define SEG_N0 0x82    // 數字0
#define SEG_N1 0xEE    // 數字1
#define SEG_N2 0x07    // 數字2
// ... 其他數字定義
#define SEG_N16 0x7F   // 負號
```

## 技術重點

### 密碼鎖系統
- **隨機數產生**: 使用多種種子來源確保隨機性
- **狀態管理**: 使用靜態變數管理系統狀態
- **LED控制**: 實作複雜的LED跑馬燈效果
- **LCD顯示**: 支援多行文字顯示

### 數位顯示控制
- **進制轉換**: 支援多種進制顯示
- **位元運算**: 實作位移和位元操作
- **顯示格式**: 支援不同格式的數值顯示

### 七段顯示器驅動
- **多工顯示**: 使用時間分割技術
- **字元映射**: 定義數字符號的段模式
- **硬體控制**: 直接控制GPIO腳位

### 按鍵處理
- **防彈跳**: 避免按鍵重複觸發
- **狀態檢測**: 檢測按鍵按下和釋放
- **功能映射**: 將按鍵映射到對應功能

## 程式架構

### 初始化階段
```c
SYS_Init();              // 系統初始化
init_LCD();              // LCD初始化
OpenKeyPad();            // 按鍵掃描初始化
OpenSevenSegment();      // 七段顯示器初始化
// 硬體初始化
```

### 主迴圈結構
```c
while(1) {
    // 顯示更新
    // 按鍵掃描
    // 事件處理
    // 延遲控制
}
```

### 函數模組
- **硬體控制**: LED、蜂鳴器、顯示器控制
- **密碼管理**: 密碼產生、驗證、顯示
- **使用者介面**: LCD顯示、按鍵處理
- **數值處理**: 進制轉換、位元運算

## 學習目標
- 掌握複雜嵌入式系統設計
- 理解多種顯示器控制技術
- 學習隨機數產生和密碼系統
- 熟悉LED動態效果實作
- 培養系統整合和除錯能力

## 擴展應用
- 可增加更多密碼驗證功能
- 可實作更複雜的LED效果
- 可增加聲音回饋功能
- 可整合感測器輸入
- 可實作網路通訊功能

## 注意事項
- 密碼產生要確保隨機性
- LED控制要避免過度電流
- 顯示更新要確保同步性
- 按鍵處理要避免重複觸發
- 硬體連接要確保正確性
