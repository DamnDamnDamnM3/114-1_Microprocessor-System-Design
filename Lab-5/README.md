# Lab 5: 密碼鎖系統與數值顯示控制

## 📋 實驗概述

Lab 5 包含兩個子實驗，分別實作密碼鎖系統和數值顯示與位元操作系統。這些實驗整合了多種硬體週邊設備，包括LCD顯示器、七段顯示器、LED、蜂鳴器和按鍵矩陣，展示了嵌入式系統的綜合應用。

## 🔧 硬體環境

- **微控制器**: NUC100系列微控制器
- **開發板**: Nu-LB-NUC140開發板
- **主要週邊**: LCD顯示器、七段顯示器、LED陣列、蜂鳴器、3x3按鍵矩陣

## 🔌 硬體連接

### 通用連接
- **PA0,1,2,3,4,5**: 連接至3x3按鍵矩陣
- **PC4,5,6,7**: 連接至七段顯示器位選（數位選擇）
- **PE0-7**: 連接至七段顯示器段選（段控制）
- **LCD顯示器**: 透過SPI或I2C連接

### Lab 5.1 專用連接
- **PC12,13,14,15**: 連接至LED指示器
- **PB11**: 連接至蜂鳴器

## 📁 程式檔案說明

### Lab 5.1: 密碼鎖系統

#### `5.1/Q1.c` - 密碼鎖主程式
- **功能**: 實作4位數密碼鎖系統
- **特色**:
  - 隨機密碼產生（數字1-6）
  - 熵累積機制增強隨機性
  - 最多4次嘗試機會
  - LED跑馬燈成功提示
  - 蜂鳴器錯誤提示
  - LCD顯示輸入和驗證結果

#### `5.1/Seven_Segment.c` - 七段顯示器控制
- **功能**: 提供七段顯示器的基本控制功能
- **支援**: 數字0-9和十六進制A-F顯示

### Lab 5.2: 數值顯示與位元操作

#### `5.2/Q2.c` - 數值顯示主程式
- **功能**: 實作數值的多種顯示模式和位元操作
- **特色**:
  - LCD二進制顯示（0bxxxxxxxx格式）
  - 三種七段顯示模式：無符號整數(U)、有符號整數(S)、十六進制(X)
  - 位元操作：左移、右移、清零
  - 隨機數產生
  - 負數顯示支援

#### `5.2/Seven_Segment.c` - 七段顯示器控制（支援負號）
- **功能**: 提供七段顯示器的進階控制功能
- **支援**: 數字0-9、十六進制A-F、負號"-"顯示

## 🎮 按鍵對應表

### Lab 5.1 按鍵功能
| 按鍵 | 功能 | 說明 |
|------|------|------|
| 1-6 | 密碼輸入 | 輸入數字1-6 |
| 7 | 重新產生密碼 | 產生新的隨機密碼 |
| 8 | 清除輸入 | 清除當前輸入 |
| 9 | 確認輸入 | 驗證密碼 |

### Lab 5.2 按鍵功能
| 按鍵 | 功能 | 說明 |
|------|------|------|
| 1 | 右移設最高位 | `(N>>1)\|0x80` |
| 2 | 產生隨機數 | 產生0-255隨機數 |
| 3 | 左移設最低位 | `(N<<1)\|0x01` |
| 4 | 右移 | `N>>1` |
| 5 | 清零 | 設為0 |
| 6 | 左移 | `N<<1` |
| 7 | 無符號模式 | 顯示為無符號整數 |
| 8 | 有符號模式 | 顯示為有符號整數 |
| 9 | 十六進制模式 | 顯示為十六進制 |

## 🔍 技術重點

### 1. 隨機數產生與熵累積
- 使用多個熵源（系統時鐘、使用者互動、記憶體位址）
- 複雜的種子混合演算法
- 持續的熵累積機制

### 2. 七段顯示器多工顯示
- 位選和段選分離控制
- 多工掃描技術
- 支援多種顯示模式

### 3. 位元操作與數值轉換
- 二進制、十進制、十六進制轉換
- 有符號和無符號數值處理
- 位元移位和邏輯運算

### 4. 狀態機設計
- 密碼驗證狀態管理
- 顯示模式切換
- 按鍵防彈跳處理

## 🏗️ 程式架構

### Lab 5.1 架構
```
主程式迴圈
├── 熵累積
├── 七段顯示器密碼顯示
├── 按鍵掃描
└── 按鍵處理
    ├── 數字輸入
    ├── 密碼產生
    ├── 清除功能
    └── 密碼驗證
        ├── 成功：LED跑馬燈
        └── 失敗：蜂鳴器響聲
```

### Lab 5.2 架構
```
主程式迴圈
├── 按鍵掃描
├── 按鍵處理
│   ├── 位元操作
│   ├── 模式切換
│   └── 隨機數產生
├── 顯示更新
│   ├── LCD二進制顯示
│   └── 七段顯示器刷新
└── 狀態記錄
```

## 🎯 學習目標

1. **硬體整合**: 學習多種週邊設備的整合應用
2. **隨機數產生**: 了解嵌入式系統中的隨機數產生技術
3. **顯示技術**: 掌握LCD和七段顯示器的控制方法
4. **位元操作**: 熟練使用位元運算進行數值處理
5. **狀態管理**: 學習複雜系統的狀態機設計
6. **使用者介面**: 設計直觀的按鍵操作介面

## 🚀 擴展應用

### 密碼鎖系統擴展
- 增加密碼長度設定
- 實作密碼歷史記錄
- 添加時間鎖定功能
- 支援多使用者管理

### 數值顯示系統擴展
- 增加浮點數顯示
- 實作科學記號顯示
- 添加單位轉換功能
- 支援更多進制轉換

### 硬體擴展
- 整合更多LED效果
- 添加聲音提示
- 實作觸控螢幕介面
- 增加無線通訊功能

## ⚠️ 注意事項

1. **硬體連接**: 確保所有週邊設備正確連接
2. **電源管理**: 注意LED和蜂鳴器的電流消耗
3. **顯示更新**: 七段顯示器需要持續刷新
4. **按鍵防彈跳**: 實作適當的按鍵防彈跳機制
5. **記憶體使用**: 注意字串緩衝區的大小限制
6. **隨機性**: 確保隨機數種子的多樣性

## 📚 相關技術

- **GPIO控制**: 數位I/O腳位設定和控制
- **定時器**: 延遲和時序控制
- **中斷處理**: 按鍵中斷和系統時鐘
- **記憶體管理**: 變數和陣列的使用
- **字串處理**: sprintf和字串操作函數
- **數學運算**: 位元運算和數值轉換

---

**作者**: damnm3@googlegroups.com 共同作者  
**版本**: 1.0  
**更新日期**: 2024年