/*
 * ================================================================
 * Lab 2 - Question 2: GPIO按鍵控制LED動態顯示
 * 功能：使用3x3按鍵矩陣控制4個LED的動態顯示效果
 * 硬體：Nu-LB-NUC140開發板，NUC140VE3CN微控制器
 * 作者：damnm3@googlegroups.com 共同作者
 * ================================================================
 * 
 * 硬體連接：
 * - PA0,1,2,3,4,5 連接至3x3按鍵矩陣
 * - PC12,13,14,15 連接至LED（或繼電器）
 * 
 * 按鍵對應的LED動態顯示效果：
 * 按鍵1: LED依序點亮（PC12→PC13→PC14→PC15）
 * 按鍵2: LED全部點亮後全部熄滅（閃爍效果）
 * 按鍵3: LED反向依序點亮（PC15→PC14→PC13→PC12）
 * 其他: 所有LED關閉
 */

// 包含必要的標頭檔
#include <stdio.h>              // 標準輸入輸出函數
#include "NUC100Series.h"       // NUC100系列微控制器定義
#include "MCU_init.h"          // 微控制器初始化函數
#include "SYS_init.h"          // 系統初始化函數
#include "Scankey.h"           // 按鍵掃描函數

/*
 * ================================================================
 * GPIO初始化函數
 * 功能：設定PC12,13,14,15為輸出模式，並初始化為高電位（LED關閉）
 * ================================================================
 */
void Init_GPIO(void)
{
    // 設定PC12為輸出模式
    GPIO_SetMode(PC, BIT12, GPIO_MODE_OUTPUT);
    // 設定PC13為輸出模式
    GPIO_SetMode(PC, BIT13, GPIO_MODE_OUTPUT);
    // 設定PC14為輸出模式
    GPIO_SetMode(PC, BIT14, GPIO_MODE_OUTPUT);
    // 設定PC15為輸出模式
    GPIO_SetMode(PC, BIT15, GPIO_MODE_OUTPUT);
    
    // 初始化所有LED為關閉狀態（高電位）
    PC12=1; PC13=1; PC14=1; PC15=1;
}

/*
 * ================================================================
 * 主程式
 * 功能：系統初始化和主迴圈，實作動態LED顯示效果
 * ================================================================
 */
int main(void)
{
    uint32_t i = 0;            // 按鍵掃描結果變數
    
    // ================================================================
    // 系統初始化階段
    // ================================================================
    SYS_Init();                // 系統初始化
    OpenKeyPad();              // 開啟按鍵掃描功能
    Init_GPIO();               // 初始化GPIO設定

    // ================================================================
    // 主程式迴圈
    // ================================================================
    while(1) {
        // 掃描按鍵狀態
        i = ScanKey();
        
        // 根據按鍵值執行對應的LED動態顯示效果
        switch(i) {
            // 按鍵1 - LED依序點亮效果（從左到右）
            case 1 :
                // 全部關閉
                PC12=1; PC13=1; PC14=1; PC15=1;
                // PC12點亮
                PC12=0; PC13=1; PC14=1; PC15=1;
                CLK_SysTickDelay(100000);    // 延遲100ms
                // PC13點亮
                PC12=1; PC13=0; PC14=1; PC15=1;
                CLK_SysTickDelay(100000);    // 延遲100ms
                // PC14點亮
                PC12=1; PC13=1; PC14=0; PC15=1;
                CLK_SysTickDelay(100000);    // 延遲100ms
                // PC15點亮
                PC12=1; PC13=1; PC14=1; PC15=0;
                CLK_SysTickDelay(100000);    // 延遲100ms
                break;
                
            // 按鍵2 - LED閃爍效果（全部點亮後全部熄滅）
            case 2 : 
                // 全部點亮
                PC12=0; PC13=0; PC14=0; PC15=0; 
                CLK_SysTickDelay(100000);    // 延遲100ms
                // 全部熄滅
                PC12=1; PC13=1; PC14=1; PC15=1;
                CLK_SysTickDelay(100000);    // 延遲100ms
                break;
                
            // 按鍵3 - LED反向依序點亮效果（從右到左）
            case 3 : 
                // 全部關閉
                PC12=1; PC13=1; PC14=1; PC15=1;
                // PC15點亮
                PC12=1; PC13=1; PC14=1; PC15=0;
                CLK_SysTickDelay(100000);    // 延遲100ms
                // PC14點亮
                PC12=1; PC13=1; PC14=0; PC15=1;
                CLK_SysTickDelay(100000);    // 延遲100ms
                // PC13點亮
                PC12=1; PC13=0; PC14=1; PC15=1;
                CLK_SysTickDelay(100000);    // 延遲100ms
                // PC12點亮
                PC12=0; PC13=1; PC14=1; PC15=1;
                CLK_SysTickDelay(100000);    // 延遲100ms
                break;
            
            // 預設情況 - 所有LED關閉
            default: PC12=1; PC13=1; PC14=1; PC15=1; break;
        }
    }
}
