# Lab 4 - 隨機數產生與交通號誌控制系統

## 實驗概述
本實驗使用NUC100系列微控制器，實作兩個不同的應用程式：隨機數產生與餘數計算顯示系統，以及交通號誌控制系統。結合數學運算、狀態機設計和即時控制，建立實用的嵌入式系統應用。

## 硬體環境
- **微控制器**: NUC100系列
- **按鍵矩陣**: 3x3按鍵矩陣連接至PA0,1,2,3,4,5
- **七段顯示器**: 4位七段顯示器連接至PC4,5,6,7(位選)和PE0-7(段選)
- **LED**: 交通號誌LED連接至PA12,13,14

## 硬體連接說明

### 按鍵矩陣連接
```
按鍵矩陣    →    GPIO腳位
Row 0      →    PA0
Row 1      →    PA1  
Row 2      →    PA2
Col 0      →    PA3
Col 1      →    PA4
Col 2      →    PA5
```

### 七段顯示器連接
```
七段顯示器  →    GPIO腳位    功能
位選1      →    PC4        第1個顯示器
位選2      →    PC5        第2個顯示器
位選3      →    PC6        第3個顯示器
位選4      →    PC7        第4個顯示器
段A        →    PE3        頂段
段B        →    PE4        右上段
段C        →    PE0        右下段
段D        →    PE5        底段
段E        →    PE6        左下段
段F        →    PE2        左上段
段G        →    PE7        中段
段DOT      →    PE1        小數點
```

### 交通號誌LED連接
```
LED顏色    →    GPIO腳位    功能
藍色LED    →    PA12       背景光
綠色LED    →    PA13       綠燈指示
紅色LED    →    PA14       紅燈指示
```

## 程式檔案說明

### Q1.c - 隨機數產生與餘數計算顯示
**功能**: 產生隨機數並計算不同除數的餘數，在七段顯示器上顯示結果

**按鍵功能表**:
| 按鍵 | 功能 | 說明 |
|------|------|------|
| 3    | 產生隨機數 | 產生0-99的隨機數 |
| 1    | 計算餘數 | 計算隨機數除以2的餘數 |
| 4    | 計算餘數 | 計算隨機數除以3的餘數 |
| 7    | 計算餘數 | 計算隨機數除以5的餘數 |
| 9    | 清除顯示 | 清除所有數值並關閉顯示器 |

**顯示格式**:
```
位置3: 餘數的個位數
位置2: 空白
位置1: 原數的十位數
位置0: 原數的個位數
```

**程式流程**:
1. 系統初始化
2. 按鍵3按下時產生隨機數
3. 按鍵1,4,7計算不同餘數
4. 在七段顯示器上顯示結果
5. 按鍵9清除所有顯示

**隨機數產生**:
- 使用`seedCounter`作為種子
- 每次迴圈增加種子值
- 使用`rand() % 100`產生0-99的隨機數

### Q2.c - 交通號誌控制系統
**功能**: 實作交通號誌的狀態控制和倒數計時顯示

**交通號誌狀態**:
| 狀態 | 持續時間 | LED狀態 | 說明 |
|------|----------|---------|------|
| 綠燈 | 8秒 | PA12=1, PA13=0, PA14=1 | 車輛可通行 |
| 黃燈 | 5秒 | PA12=1, PA13=0, PA14=0 | 準備停止 |
| 紅燈 | 13秒 | PA12=1, PA13=1, PA14=0 | 車輛停止 |

**按鍵控制**:
| 按鍵 | 功能 | 說明 |
|------|------|------|
| 1    | 強制綠燈 | 立即切換到綠燈狀態 |
| 2    | 強制黃燈 | 立即切換到黃燈狀態 |
| 3    | 強制紅燈 | 立即切換到紅燈狀態 |
| 9    | 增加時間 | 增加5秒倒數時間 |

**狀態轉換**:
```
綠燈(8秒) → 黃燈(5秒) → 紅燈(13秒) → 綠燈(8秒) → ...
```

**程式架構**:
- 使用結構體管理交通號誌狀態
- 使用列舉定義狀態類型
- 使用狀態機處理狀態轉換
- 使用計數器實現倒數計時

## 技術重點

### 隨機數產生
- **種子設定**: 使用計數器作為隨機數種子
- **範圍控制**: 使用模運算限制隨機數範圍
- **時序控制**: 確保每次產生不同的隨機數

### 狀態機設計
- **狀態定義**: 使用列舉定義系統狀態
- **狀態轉換**: 使用switch語句處理狀態轉換
- **狀態保持**: 使用結構體保存狀態資訊

### 時間控制
- **精確計時**: 使用計數器實現精確的時間控制
- **倒數計時**: 實現倒數計時功能
- **狀態同步**: 確保LED和顯示器同步更新

### 按鍵處理
- **防彈跳**: 避免按鍵重複觸發
- **狀態檢測**: 檢測按鍵按下和釋放
- **即時響應**: 提供即時的控制響應

## 程式架構

### 初始化階段
```c
SYS_Init();              // 系統初始化
Init_GPIO();             // GPIO初始化
OpenSevenSegment();      // 七段顯示器初始化
OpenKeyPad();            // 按鍵掃描初始化
```

### 主迴圈結構
```c
while(1) {
    key = ScanKey();     // 掃描按鍵
    // 處理按鍵事件
    // 更新顯示
    // 處理時間控制
}
```

### 函數模組
- **Display_Lab4_1()**: 餘數顯示函數
- **TrafficSignal_initialize()**: 交通號誌初始化
- **TrafficSignal_countDown()**: 倒數計時處理
- **Show_LED()**: LED狀態顯示

## 學習目標
- 掌握隨機數產生技術
- 理解狀態機設計原理
- 學習即時系統控制
- 熟悉嵌入式系統時間管理
- 培養系統整合設計能力

## 擴展應用
- 可增加更多數學運算功能
- 可實作更複雜的交通號誌系統
- 可增加感測器輸入
- 可整合網路通訊功能
- 可實作多路口協調控制

## 注意事項
- 隨機數種子要確保變化性
- 狀態機轉換要確保正確性
- 時間控制要確保精確性
- 按鍵處理要避免重複觸發
- 顯示更新要確保同步性
